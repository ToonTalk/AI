:root{
  --bg:#0b1020; --panel:#121a33; --ink:#eef2ff; --muted:#b9c3ff;
  --accent:#48d1ff; --accent2:#7c5cff; --good:#3ee06d; --warn:#ffcc4d;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:radial-gradient(1200px 900px at 50% -200px, #1a244a, #0b1020 60%) fixed; color:var(--ink); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
header{display:flex;align-items:center;gap:.75rem;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.06);backdrop-filter:blur(6px);position:sticky;top:0;z-index:5}
header h1{font-size:clamp(18px,2.5vw,22px);margin:0;font-weight:800;letter-spacing:.2px}
header .badge{background:linear-gradient(135deg,var(--accent),rgba(124,92,255,.85));padding:.25rem .5rem;border-radius:999px;font-size:.75rem;color:#0c0620}

.container{display:grid;grid-template-columns:minmax(560px, 1.1fr) minmax(320px, .9fr);gap:14px;padding:14px;max-width:1400px;margin:0 auto}
.card{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);overflow:hidden}
.card h2{margin:0;padding:10px 14px;border-bottom:1px solid rgba(255,255,255,.06);font-size:15px;letter-spacing:.3px;color:var(--muted)}

.playbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;padding:10px 14px;border-bottom:1px solid rgba(255,255,255,.06)}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
label{font-size:13px;color:var(--muted);display:inline-flex;gap:6px;align-items:center}
select, input[type="checkbox"]{accent-color:var(--accent2)}
select{background:#0d1530;color:var(--ink);border:1px solid rgba(255,255,255,.1);border-radius:8px;padding:6px 8px}

.btn{appearance:none;border:none;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:var(--ink);padding:8px 12px;border-radius:14px;font-weight:600;cursor:pointer;box-shadow:0 3px 10px rgba(0,0,0,.25)}
.btn:hover{transform:translateY(-1px)}
.btn.ghost{background:rgba(255,255,255,.04)}
.btn[disabled]{opacity:.6;cursor:progress}
input.num{background:#0d1530;color:var(--ink);border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:6px 8px;width:80px}

#pondWrap{position:relative}
#pond{display:block;width:100%;height:min(70vh, 65vw);background:radial-gradient(1200px 600px at -10% -40%, rgba(124,92,255,.12), transparent 60%),
       radial-gradient(1000px 500px at 130% 140%, rgba(72,209,255,.10), transparent 60%);
       border-bottom-left-radius:16px;border-bottom-right-radius:16px;position:relative;z-index:0}
#overlay{position:absolute;inset:0;pointer-events:none;z-index:102}
#hist{position:absolute;inset:0;pointer-events:none;z-index:99}

/* DOM duck overlay */
#duckLayer{position:absolute;inset:0;pointer-events:none;z-index:102}
.duck-wrap{position:absolute;transform:translate(-50%,-50%);display:grid;place-items:center}
.duck-emoji{font-size:42px;line-height:1;text-shadow:0 0 6px rgba(255,255,255,.85),0 0 14px rgba(255,209,102,.8)}
/* Launch birth animation */
.duck-birth{position:absolute;transform:translate(-50%,-50%) scale(1);filter:blur(0px);opacity:1;transition:transform 600ms ease, filter 600ms ease, opacity 700ms ease;font-size:34px}
.duck-birth.go{transform:translate(-50%,-50%) scale(3.8);filter:blur(8px);opacity:0}
.duck-ripple{position:absolute;transform:translate(-50%,-50%) scale(1);width:12px;height:12px;border:2px solid rgba(124,92,255,.8);border-radius:999px;opacity:.9;transition:transform 900ms ease-out, opacity 900ms ease-out}
.duck-ripple.go{transform:translate(-50%,-50%) scale(9);opacity:0}
@media (max-width:600px){ .duck-emoji{font-size:36px} }

.legend{font-size:12px;color:var(--muted);padding:8px 14px;border-top:1px dashed rgba(255,255,255,.08)}
.statbar{display:flex;gap:18px;padding:10px 14px}
.stat b{font-variant-numeric:tabular-nums}
.notes{padding:10px 14px;color:var(--muted);font-size:13px;line-height:1.4}
.guide{padding:12px 14px;color:var(--muted);font-size:13px;line-height:1.5;border-bottom:1px solid rgba(255,255,255,.06)}
.guide h3{margin:0 0 6px 0;color:var(--ink);font-size:14px}
.guide ol{margin:6px 0 0 16px;}
.guide li{margin:4px 0}
.guide .tip{margin-top:8px;color:#cfe6ff}
/* Sidebar histogram panel */
#sideHistWrap{padding:10px 14px}
#sideHistWrap h3{margin:8px 0 6px 0;font-size:14px;color:var(--muted)}
#sideHist{display:block;width:100%;height:auto;background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.08);border-radius:12px}
.mini-legend{margin-top:6px;font-size:12px;color:var(--muted)}
/* Intro overlay */
#intro{position:fixed; inset:0; padding:24px; display:grid; place-items:center; z-index:9999; background:radial-gradient(1200px 900px at 50% -200px, #1a244a, #0b1020 60%)}
.intro-card{max-width:960px; width:min(92vw, 960px); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.12); border-radius:18px; box-shadow:0 10px 40px rgba(0,0,0,.5); padding:18px 20px}
.intro-card h1{margin:4px 0 8px 0; font-size:22px; letter-spacing:.3px}
.intro-card p{color:var(--muted); margin:8px 0}
.intro-card ol{margin:10px 0 0 18px; color:var(--muted)}
.intro-actions{display:flex; gap:12px; align-items:center; margin-top:14px}

/* CSS FOR DOM DUCKS */
#domDuckLayer {
  position: absolute;
  inset: 0;
  pointer-events: none;
  overflow: hidden;
  z-index: 101;
}

.dom-duck {
  position: absolute;
  font-size: 20px;
  will-change: opacity;
  opacity: 0;
  transition: opacity 150ms linear;
  transform: translate(-50%, -50%);
}