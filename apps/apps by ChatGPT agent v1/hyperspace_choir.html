<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hyperspace Choir</title>
  <style>
    html,body{margin:0;height:100%;overflow:hidden;background:#0b1a2e;}
    canvas{display:block;cursor:pointer;}
  </style>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
function resize(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
window.addEventListener('resize',resize);resize();

const AudioContext=window.AudioContext||window.webkitAudioContext;
const audioCtx=new AudioContext();

// shape objects that produce chord when clicked
class Shape{
  constructor(){this.reset();}
  reset(){
    this.x=Math.random()*canvas.width;
    this.y=Math.random()*canvas.height;
    this.size=20+Math.random()*40;
    this.rotation=Math.random()*Math.PI*2;
    this.color=`hsla(${Math.random()*360},70%,60%,0.6)`;
  }
  contains(px,py){
    return Math.hypot(px-this.x,py-this.y)<this.size;
  }
  draw(){
    ctx.save();ctx.translate(this.x,this.y);ctx.rotate(this.rotation);
    ctx.beginPath();
    for(let i=0;i<6;i++){
      const angle=(Math.PI*2/6)*i;
      const r=this.size*(i%2?0.5:1);
      const vx=r*Math.cos(angle);
      const vy=r*Math.sin(angle);
      if(i===0)ctx.moveTo(vx,vy);else ctx.lineTo(vx,vy);
    }
    ctx.closePath();
    ctx.fillStyle=this.color;
    ctx.fill();
    ctx.restore();
    // slow rotation
    this.rotation+=0.002;
  }
}
const shapes=[];
for(let i=0;i<15;i++) shapes.push(new Shape());

// play a chord using three oscillators
function playChord(){
  const freqs=[220,275,330].map(f=>f*Math.pow(2,Math.random()*2));
  const now=audioCtx.currentTime;
  freqs.forEach((freq,i)=>{
    const osc=audioCtx.createOscillator();
    const gain=audioCtx.createGain();
    osc.type='sine'; osc.frequency.value=freq;
    osc.connect(gain).connect(audioCtx.destination);
    gain.gain.setValueAtTime(0.0,now);
    gain.gain.linearRampToValueAtTime(0.2,now+0.02);
    gain.gain.exponentialRampToValueAtTime(0.001,now+1.5);
    osc.start(now);
    osc.stop(now+1.5);
  });
}

canvas.addEventListener('click',e=>{
  const rect=canvas.getBoundingClientRect();
  const x=e.clientX-rect.left;
  const y=e.clientY-rect.top;
  for(const s of shapes){
    if(s.contains(x,y)){
      playChord();
      s.reset();
      break;
    }
  }
});

function animate(){
  ctx.fillStyle='rgba(11,26,46,0.15)';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  // draw twinkling points
  for(let i=0;i<40;i++){
    const x=Math.random()*canvas.width;
    const y=Math.random()*canvas.height;
    ctx.fillStyle=`rgba(255,255,255,${Math.random()*0.2})`;
    ctx.fillRect(x,y,2,2);
  }
  shapes.forEach(s=>s.draw());
  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>