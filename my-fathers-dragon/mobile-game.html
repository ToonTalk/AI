<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>My Father's Dragon - Adventure Game</title>

    <!-- PWA / Add-to-Home-Screen support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Dragon Adventure">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a1a2e">
    <link rel="apple-touch-icon" href="scene_intro.png">
    <script>
        // Inline web app manifest (no separate file needed)
        const manifest = {
            name: "My Father's Dragon - Adventure Game",
            short_name: "Dragon Adventure",
            start_url: ".",
            display: "fullscreen",
            orientation: "any",
            background_color: "#1a1a2e",
            theme_color: "#1a1a2e",
            icons: [{ src: "scene_intro.png", sizes: "512x512", type: "image/png" }]
        };
        const blob = new Blob([JSON.stringify(manifest)], { type: "application/json" });
        const link = document.createElement("link");
        link.rel = "manifest";
        link.href = URL.createObjectURL(blob);
        document.head.appendChild(link);
    </script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #1a1a2e; color: #eee; font-family: Georgia, serif; overflow: hidden; height: 100vh; height: 100dvh; }
        #root { width: 100%; height: 100%; }
        button { touch-action: manipulation; }

        /* Fullscreen toggle button */
        .fullscreen-btn {
            position: fixed; top: 12px; left: 12px; z-index: 9999;
            width: 40px; height: 40px;
            background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.25);
            border-radius: 8px; color: #fff; font-size: 18px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
            transition: opacity 0.3s;
            opacity: 0.6;
            padding: 0;
        }
        .fullscreen-btn:hover, .fullscreen-btn:active { opacity: 1; }
        /* Hide when already in standalone/PWA mode */
        @media (display-mode: standalone), (display-mode: fullscreen) {
            .fullscreen-btn { display: none; }
        }

        /* Mobile-specific styles */
        @media (max-width: 768px) {
            body { -webkit-text-size-adjust: 100%; }
        }
        @media (max-width: 480px), (max-height: 700px) and (max-width: 768px) {
            .mobile-text-overlay {
                max-height: 40vh !important;
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch;
                padding: 20px 16px 16px !important;
            }
            .mobile-text-overlay p {
                font-size: 14px !important;
            }
            .mobile-inventory {
                overflow-x: auto !important;
                flex-wrap: nowrap !important;
                -webkit-overflow-scrolling: touch;
                padding: 8px 8px !important;
                gap: 8px !important;
                justify-content: flex-start !important;
            }
            .mobile-inventory button {
                min-width: 60px !important;
                padding: 6px 8px !important;
                flex-shrink: 0 !important;
            }
            .mobile-inventory button span:first-child {
                font-size: 24px !important;
            }
            .mobile-inventory button span:last-child {
                font-size: 10px !important;
            }
            .mobile-title {
                font-size: 32px !important;
            }
            .mobile-subtitle {
                font-size: 16px !important;
            }
            .mobile-start-btn {
                padding: 12px 36px !important;
                font-size: 20px !important;
            }
            .mobile-ending-img {
                width: 95% !important;
            }
            .mobile-credits-img {
                width: 150px !important;
            }
            .mobile-intro-story p {
                font-size: 14px !important;
                line-height: 1.5 !important;
            }
            .mobile-intro-story {
                max-height: 50vh !important;
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch;
                padding: 20px 16px 16px !important;
            }
            .mobile-credits-container {
                padding: 20px 16px !important;
            }
            .mobile-credits-container p {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
const { useState, useEffect, useRef, useCallback } = React;

const AUDIO = {
    intro: "intro.wav",
    mud_intro: "mud_intro.wav", mud_success: "mud_success.wav",
    tigers_intro: "tigers_intro.wav", tigers_success: "tigers_success.wav",
    lions_intro: "lions_intro.wav", lions_success: "lions_success.wav",
    crocs_intro: "crocs_intro.wav", crocs_success: "crocs_success.wav",
    dragon_intro: "dragon_intro.wav", dragon_step1: "dragon_step1.wav",
    dragon_step2: "dragon_step2.wav", ending: "ending.wav"
};

const IMAGES = {
    intro: "scene_intro.png", mud: "scene_mud.png",
    tigers: "scene_tigers.png", lions: "scene_lions.png",
    crocodiles: "scene_crocodiles.png", dragon: "scene_dragon.png",
    ending: "scene_ending.png"
};

const SUCCESS_IMAGES = {
    mud: "success_mud.png",
    tigers: "success_tigers.png",
    lions: "success_lions.png",
    crocodiles: "success_crocodiles.png",
    dragon_step1: "success_dragon_paste.png",
    dragon_step2: "success_dragon_free.png"
};

const ALL_ITEMS = [
    { id: "gum", name: "Chewing Gum", emoji: "ðŸ¬" },
    { id: "lollipops", name: "Lollipops", emoji: "ðŸ­" },
    { id: "ribbons", name: "Hair Ribbons", emoji: "ðŸŽ€" },
    { id: "comb", name: "Comb", emoji: "ðŸª®" },
    { id: "toothbrush", name: "Toothbrush", emoji: "ðŸª¥" },
    { id: "toothpaste", name: "Toothpaste", emoji: "ðŸ¦·" },
    { id: "bands", name: "Rubber Bands", emoji: "âž°" },
    { id: "knife", name: "Jackknife", emoji: "ðŸ”ª" },
    { id: "magnifying", name: "Magnifying Glass", emoji: "ðŸ”" }
];

function shuffleArray(arr) {
    const shuffled = [...arr];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

function speakText(text) {
    if (window.speechSynthesis) {
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.rate = 0.9;
        window.speechSynthesis.speak(u);
    }
}

const SCENES = {
    mud: {
        introAudio: "mud_intro",
        introText: "The path ahead dissolves into deep, sucking mud. One wrong step and you'll sink up to your knees, or worse.",
        correctItem: "gum",
        successAudio: "mud_success",
        successText: "You chew the gum thoughtfully, then stick it to your shoes. It's disgusting. It's brilliant. You walk right across.",
        failText: "That won't help you cross. Think stickier."
    },
    tigers: {
        introAudio: "tigers_intro",
        introText: "Seven Bengal tigers lounge across the path. One opens an eye. 'Another traveler. How tedious. We're not going to eat you. Too much effort. But we're certainly not moving either.'",
        correctItem: "ribbons",
        successAudio: "tigers_success",
        successText: "You offer the ribbons. A tiger sniffs, then gasps. 'Oh! Oh, this is divine! Reginald, look at my tail, look at it!' Within moments, all seven are comparing tail decorations. They don't even notice you slip past.",
        failText: "The tigers aren't interested in that. Think about what might make their tails look fabulous."
    },
    lions: {
        introAudio: "lions_intro",
        introText: "A pride of lions blocks the clearing, but something's wrong. They're hiding their faces. 'Don't look at us!' one wails. 'The grooming monkey quit three weeks ago and we are a disaster.'",
        correctItem: "comb",
        successAudio: "lions_success",
        successText: "You hold up the comb. Seven pairs of hopeful eyes lock onto it. Twenty minutes later, seven magnificent manes gleam in the sunlight. 'You,' the lead lion says with quiet dignity, 'have a gift. Go with our blessing. And tell no one you saw us like this.'",
        failText: "A lion sighs dramatically. 'How would that help our manes?'"
    },
    crocodiles: {
        introAudio: "crocs_intro",
        introText: "The river stretches wide. Crocodile backs form stepping stones acrossâ€”but they're watching you. 'Toll bridge,' one says, sliding the words together. 'Nothing'sss free, little morsssel. Make usss beautiful and you may crosss. Fail, and... well.' It smiles with many teeth.",
        correctItem: "bands",
        successAudio: "crocs_success",
        successText: "You stretch a rubber band between two tails. BOING! A crocodile gigglesâ€”actually giggles. 'Again! Again!' Soon they're all bouncing, utterly delighted. 'The othersss will be SO jealousss,' one sighs happily as you hop across their backs.",
        failText: "The crocodile yawns, showing every tooth. 'Not beautiful enough. Try again.'"
    }
};

const DRAGON = {
    introAudio: "dragon_intro",
    introText: "There! A small blue dragon with golden wings, tied to a post. He sees you and his eyes go wide. 'Oh!' he whispers urgently. 'Are you here to rescue me? Pleaseâ€”but QUIETLY. The boar is a light sleeper and a HEAVY biter.'",
    step1Item: "toothpaste", step1Audio: "dragon_step1",
    step1Text: "You squeeze toothpaste along the rope. It glistens. 'Clever!' Boris breathes. 'Now it won't make noise when you cut it.'",
    step2Item: "knife", step2Audio: "dragon_step2",
    step2Text: "The knife slides through the lubricated rope like butter, silently. Boris stretches his wings for the first time in months. 'I'm Boris,' he whispers, tears in his dragon eyes. 'I can never thank you enough. Now, hold on tight and don't let go.'",
    wrongOrderText: "You saw at the rope. It CREAKS loudly. The boar snorts and shifts. You freeze. Boris's eyes are huge. 'Something to make it quieter first!' he hisses.",
    wrongItemText: "Boris shakes his head frantically. 'That won't cut rope!'"
};

const ENDING_TEXT = "And so Elmer flew away on the dragon's back, over Wild Island and out across the wide blue sea. The wind tasted like freedom and adventure. 'Where are we going?' Boris asked. Elmer laughed. He had absolutely no idea. But that, dear reader, is another story entirely.\n\nThe End";

function App() {
    const [gameState, setGameState] = useState("intro");
    const [currentScene, setCurrentScene] = useState(0);
    const [inventory, setInventory] = useState(() => shuffleArray(ALL_ITEMS));
    const [usedItems, setUsedItems] = useState([]);
    const [message, setMessage] = useState("");
    const [showMessage, setShowMessage] = useState(false);
    const [successImage, setSuccessImage] = useState(null);
    const [dragonStep, setDragonStep] = useState(0);
    const [introPhase, setIntroPhase] = useState("video");
    const [isPlaying, setIsPlaying] = useState(false);
    const audioRef = useRef(null);
    const videoRef = useRef(null);

    const sceneOrder = ["mud", "tigers", "lions", "crocodiles"];

    const stopAll = useCallback(() => {
        if (audioRef.current) { clearTimeout(audioRef.current._fallback); audioRef.current.pause(); audioRef.current.currentTime = 0; }
        if (window.speechSynthesis) window.speechSynthesis.cancel();
    }, []);

    const playAudio = useCallback((key, onEnd) => {
        stopAll();
        const src = AUDIO[key];
        if (!src) return;
        const audio = new Audio(src);
        audioRef.current = audio;
        setIsPlaying(true);
        audio.onended = () => { clearTimeout(audio._fallback); setIsPlaying(false); if (onEnd) onEnd(); };
        audio.onerror = () => { clearTimeout(audio._fallback); setIsPlaying(false); };
        audio.onloadedmetadata = () => {
            if (onEnd && audio.duration > 0) {
                audio._fallback = setTimeout(() => { setIsPlaying(false); onEnd(); }, (audio.duration + 1) * 1000);
            }
        };
        audio.play().catch(() => { setIsPlaying(false); });
    }, [stopAll]);

    useEffect(() => {
        if (gameState === "playing") {
            const scene = SCENES[sceneOrder[currentScene]];
            setSuccessImage(null);
            playAudio(scene.introAudio);
        } else if (gameState === "dragon" && dragonStep === 0) {
            setSuccessImage(null);
            playAudio(DRAGON.introAudio);
        } else if (gameState === "introScene") {
            playAudio("intro", () => { setGameState("playing"); });
        } else if (gameState === "ending") {
            playAudio("ending");
        }
    }, [gameState, currentScene]);

    const handleVideoEnd = () => { setIntroPhase("ready"); };

    const handleSkip = (e) => {
        e.stopPropagation();
        if (videoRef.current) videoRef.current.pause();
        stopAll();
        setGameState("introScene");
    };

    const handleStartGame = () => { stopAll(); setGameState("introScene"); };

    const handleItemClick = (e, item) => {
        e.stopPropagation();
        if (isPlaying) return;
        if (usedItems.includes(item.id)) return;

        if (gameState === "playing") {
            const scene = SCENES[sceneOrder[currentScene]];
            if (item.id === scene.correctItem) {
                setMessage(scene.successText);
                setShowMessage(true);
                setSuccessImage(SUCCESS_IMAGES[sceneOrder[currentScene]]);
                setUsedItems(prev => [...prev, item.id]);
                playAudio(scene.successAudio, () => {
                    setShowMessage(false);
                    setSuccessImage(null);
                    if (currentScene < sceneOrder.length - 1) {
                        setCurrentScene(prev => prev + 1);
                    } else {
                        setGameState("dragon");
                        setDragonStep(0);
                    }
                });
            } else {
                setMessage(scene.failText);
                setShowMessage(true);
                speakText(scene.failText);
                setTimeout(() => setShowMessage(false), 3000);
            }
        } else if (gameState === "dragon") {
            if (dragonStep === 0) {
                if (item.id === DRAGON.step1Item) {
                    setMessage(DRAGON.step1Text);
                    setShowMessage(true);
                    setSuccessImage(SUCCESS_IMAGES.dragon_step1);
                    setUsedItems(prev => [...prev, item.id]);
                    setDragonStep(1);
                    playAudio(DRAGON.step1Audio);
                } else if (item.id === DRAGON.step2Item) {
                    setMessage(DRAGON.wrongOrderText);
                    setShowMessage(true);
                    speakText(DRAGON.wrongOrderText);
                    setTimeout(() => setShowMessage(false), 4000);
                } else {
                    setMessage(DRAGON.wrongItemText);
                    setShowMessage(true);
                    speakText(DRAGON.wrongItemText);
                    setTimeout(() => setShowMessage(false), 3000);
                }
            } else if (dragonStep === 1) {
                if (item.id === DRAGON.step2Item) {
                    setMessage(DRAGON.step2Text);
                    setShowMessage(true);
                    setSuccessImage(SUCCESS_IMAGES.dragon_step2);
                    setUsedItems(prev => [...prev, item.id]);
                    setDragonStep(2);
                    playAudio(DRAGON.step2Audio, () => { setGameState("ending"); });
                } else {
                    setMessage(DRAGON.wrongItemText);
                    setShowMessage(true);
                    speakText(DRAGON.wrongItemText);
                    setTimeout(() => setShowMessage(false), 3000);
                }
            }
        }
    };

    const getSceneImage = () => {
        if (successImage) return successImage;
        if (gameState === "playing") return IMAGES[sceneOrder[currentScene]];
        if (gameState === "dragon") return IMAGES.dragon;
        if (gameState === "ending") return IMAGES.ending;
        return IMAGES.intro;
    };

    const getSceneText = () => {
        if (gameState === "playing") {
            const scene = SCENES[sceneOrder[currentScene]];
            return showMessage ? message : scene.introText;
        }
        if (gameState === "dragon") {
            if (showMessage) return message;
            if (dragonStep === 0) return DRAGON.introText;
            if (dragonStep === 1) return DRAGON.step1Text;
            return DRAGON.step2Text;
        }
        if (gameState === "ending") return ENDING_TEXT;
        return "";
    };

    const handlePlayAgain = () => {
        stopAll();
        setGameState("intro");
        setIntroPhase("video");
        setCurrentScene(0);
        setDragonStep(0);
        setUsedItems([]);
        setMessage("");
        setShowMessage(false);
        setSuccessImage(null);
        setInventory(shuffleArray(ALL_ITEMS));
        // Reset video to beginning when playing again
        if (videoRef.current) {
            videoRef.current.currentTime = 0;
        }
    };

    // INTRO SCREEN
    if (gameState === "intro") {
        return (
            <div style={{
                width: "100vw", height: "100vh", height: "100dvh", display: "flex",
                flexDirection: "column", alignItems: "center", justifyContent: "center",
                backgroundImage: "url(scene_intro.png)", backgroundSize: "cover", backgroundPosition: "center"
            }}>
                {introPhase === "video" ? (
                    <div style={{ position: "relative", width: "100%", height: "100%" }}>
                        <video ref={videoRef} src="intro_video.mp4" autoPlay muted playsInline
                            onEnded={handleVideoEnd}
                            style={{ width: "100%", height: "100%", objectFit: "cover" }} />
                        <button onClick={handleSkip} style={{
                            position: "absolute", top: 16, right: 16,
                            background: "rgba(0,0,0,0.6)", color: "#fff",
                            border: "1px solid rgba(255,255,255,0.3)", borderRadius: 8,
                            padding: "8px 16px", cursor: "pointer", fontSize: 16
                        }}>Skip â–¶</button>
                    </div>
                ) : (
                    <div style={{ textAlign: "center" }}>
                        <h1 className="mobile-title" style={{
                            fontSize: 48, marginBottom: 24,
                            background: "linear-gradient(90deg, #e2b04a, #f0d68a, #e2b04a)",
                            WebkitBackgroundClip: "text", WebkitTextFillColor: "transparent"
                        }}>My Father's Dragon</h1>
                        <p className="mobile-subtitle" style={{ fontSize: 20, marginBottom: 32, color: "#aac" }}>A Point-and-Click Adventure</p>
                        <button className="mobile-start-btn" onClick={handleStartGame} style={{
                            padding: "16px 48px", fontSize: 24, cursor: "pointer",
                            background: "linear-gradient(135deg, #e2b04a, #c8963e)",
                            border: "none", borderRadius: 12, color: "#1a1a2e",
                            fontWeight: "bold", boxShadow: "0 4px 20px rgba(226,176,74,0.4)"
                        }}>Begin Adventure</button>
                    </div>
                )}
            </div>
        );
    }

    // INTRO SCENE - story narration with scene_intro.png
    if (gameState === "introScene") {
        return (
            <div style={{ width: "100vw", height: "100vh", height: "100dvh", display: "flex", flexDirection: "column", background: "#1a1a2e" }}>
                <div style={{ flex: 1, position: "relative", overflow: "hidden", minHeight: 0 }}>
                    <img src={IMAGES.intro} alt="Wild Island" style={{ width: "100%", height: "100%", objectFit: "cover" }} />
                    <div className="mobile-intro-story" style={{
                        position: "absolute", bottom: 0, left: 0, right: 0,
                        background: "linear-gradient(transparent, rgba(0,0,0,0.85))",
                        padding: "40px 24px 24px"
                    }}>
                        <p style={{ fontSize: 18, lineHeight: 1.6, textAlign: "center", maxWidth: 800, margin: "0 auto" }}>
                            Once upon a time, a boy named Elmer Elevator heard a terrible story. On a faraway place called Wild Island, a baby dragon had been captured by the wild animals and forced to fly them across the river day after day with no rest and no hope. Elmer decided to rescue him. He packed his backpack with the strangest collection of supplies you ever saw: chewing gum, hair ribbons, a comb, rubber bands, toothpaste and a jackknife, and set off across the ocean. Now he stands at the edge of Wild Island. The jungle stretches before him, dark and full of dangers. But Elmer is clever, and sometimes, dear reader, cleverness is better than strength.
                        </p>
                    </div>
                </div>
                <div style={{ display: "flex", justifyContent: "center", padding: "12px", background: "rgba(0,0,0,0.7)" }}>
                    <button onClick={() => { stopAll(); setGameState("playing"); }} style={{
                        padding: "10px 32px", fontSize: 18, cursor: "pointer",
                        background: "linear-gradient(135deg, #e2b04a, #c8963e)",
                        border: "none", borderRadius: 10, color: "#1a1a2e", fontWeight: "bold"
                    }}>Skip to Adventure</button>
                </div>
            </div>
        );
    }

    // CREDITS SCREEN
    if (gameState === "credits") {
        return (
            <div className="mobile-credits-container" style={{
                width: "100vw", height: "100vh", height: "100dvh", display: "flex",
                flexDirection: "column", alignItems: "center", justifyContent: "center",
                background: "linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)", padding: 40,
                overflowY: "auto", WebkitOverflowScrolling: "touch"
            }}>
                <img className="mobile-credits-img" src="book_cover.jpg" alt="Book cover"
                    style={{ width: 200, borderRadius: 8, boxShadow: "0 4px 20px rgba(0,0,0,0.5)", marginBottom: 24 }} />
                <p style={{ fontSize: 20, textAlign: "center", maxWidth: 600, lineHeight: 1.6, marginBottom: 16 }}>
                    If you enjoyed this game I strongly suggest you{" "}
                    <a href="https://gutenberg.org/ebooks/30017" target="_blank" rel="noopener noreferrer"
                        style={{ color: "#e2b04a" }}>read or listen to the book</a>.
                    It was my favorite book as a child.
                </p>
                <p style={{ fontSize: 18, textAlign: "center", maxWidth: 600, lineHeight: 1.6, marginBottom: 16 }}>
                    To learn how I made this game{" "}
                    <a href="https://docs.google.com/document/d/1ztVpW_UkMnI2FLicUfMlkIb4xPItTrSCTPgib44N7mA/edit?usp=sharing"
                        target="_blank" rel="noopener noreferrer" style={{ color: "#e2b04a" }}>read this</a>.
                </p>
                <p style={{ fontSize: 18, textAlign: "center" }}>
                    <a href="https://docs.google.com/document/d/1r7oaUOGs1TGjtKYo1CCmfqTifH5cqpPny5ALx5EIT_8/edit?usp=sharing"
                        target="_blank" rel="noopener noreferrer" style={{ color: "#e2b04a" }}>Ken Kahn</a>
                </p>
                <button onClick={handlePlayAgain} style={{
                    marginTop: 32, padding: "12px 36px", fontSize: 20, cursor: "pointer",
                    background: "linear-gradient(135deg, #e2b04a, #c8963e)",
                    border: "none", borderRadius: 12, color: "#1a1a2e", fontWeight: "bold"
                }}>Play Again</button>
            </div>
        );
    }

    // ENDING SCREEN
    if (gameState === "ending") {
        return (
            <div style={{
                width: "100vw", height: "100vh", height: "100dvh", display: "flex",
                flexDirection: "column", alignItems: "center", justifyContent: "center",
                background: "linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",
                overflowY: "auto", WebkitOverflowScrolling: "touch", padding: "24px 0"
            }}>
                <div className="mobile-ending-img" style={{ position: "relative", width: "80%", maxWidth: 800 }}>
                    <img src={IMAGES.ending} alt="Ending"
                        style={{ width: "100%", borderRadius: 16, boxShadow: "0 0 40px rgba(100,200,255,0.3)" }} />
                    <div className="mobile-text-overlay" style={{
                        position: "absolute", bottom: 0, left: 0, right: 0,
                        background: "linear-gradient(transparent, rgba(0,0,0,0.85))",
                        padding: "40px 24px 24px", borderRadius: "0 0 16px 16px"
                    }}>
                        <p style={{ fontSize: 18, lineHeight: 1.6, textAlign: "center", whiteSpace: "pre-line" }}>{getSceneText()}</p>
                    </div>
                </div>
                <button onClick={() => setGameState("credits")} style={{
                    marginTop: 24, padding: "12px 36px", fontSize: 20, cursor: "pointer",
                    background: "linear-gradient(135deg, #e2b04a, #c8963e)",
                    border: "none", borderRadius: 12, color: "#1a1a2e", fontWeight: "bold"
                }}>Continue</button>
            </div>
        );
    }

    // GAME SCREEN
    const availableItems = inventory.filter(item => !usedItems.includes(item.id));

    return (
        <div style={{ width: "100vw", height: "100vh", height: "100dvh", display: "flex", flexDirection: "column", background: "#1a1a2e" }}>
            <div style={{ flex: 1, position: "relative", overflow: "hidden", minHeight: 0 }}>
                <img src={getSceneImage()} alt="Scene"
                    style={{ width: "100%", height: "100%", objectFit: "cover" }} />
                <div className="mobile-text-overlay" style={{
                    position: "absolute", bottom: 0, left: 0, right: 0,
                    background: "linear-gradient(transparent, rgba(0,0,0,0.85))",
                    padding: "40px 24px 24px"
                }}>
                    <p style={{ fontSize: 18, lineHeight: 1.6, textAlign: "center", maxWidth: 800, margin: "0 auto" }}>
                        {getSceneText()}
                    </p>
                </div>
            </div>
            <div className="mobile-inventory" style={{
                display: "flex", justifyContent: "center", gap: 12,
                padding: "12px 16px", background: "rgba(0,0,0,0.7)", flexWrap: "wrap"
            }}>
                {availableItems.map(item => (
                    <button key={item.id} onClick={(e) => handleItemClick(e, item)}
                        style={{
                            display: "flex", flexDirection: "column", alignItems: "center",
                            padding: "8px 12px", background: "rgba(226,176,74,0.15)",
                            border: "1px solid rgba(226,176,74,0.4)", borderRadius: 8,
                            cursor: isPlaying ? "not-allowed" : "pointer",
                            opacity: isPlaying ? 0.5 : 1,
                            color: "#eee", fontSize: 12, minWidth: 70, transition: "all 0.2s"
                        }}>
                        <span style={{ fontSize: 28 }}>{item.emoji}</span>
                        <span>{item.name}</span>
                    </button>
                ))}
            </div>
        </div>
    );
}

function FullscreenButton() {
    const [isFS, setIsFS] = useState(!!document.fullscreenElement);
    const [supported, setSupported] = useState(false);
    const [isStandalone, setIsStandalone] = useState(false);

    useEffect(() => {
        const standalone = window.matchMedia('(display-mode: standalone)').matches
            || window.matchMedia('(display-mode: fullscreen)').matches
            || window.navigator.standalone === true;
        setIsStandalone(standalone);

        setSupported(!!document.documentElement.requestFullscreen
            || !!document.documentElement.webkitRequestFullscreen);

        const onChange = () => setIsFS(!!(document.fullscreenElement || document.webkitFullscreenElement));
        document.addEventListener('fullscreenchange', onChange);
        document.addEventListener('webkitfullscreenchange', onChange);
        return () => {
            document.removeEventListener('fullscreenchange', onChange);
            document.removeEventListener('webkitfullscreenchange', onChange);
        };
    }, []);

    if (isStandalone || !supported) return null;

    const toggle = () => {
        if (document.fullscreenElement || document.webkitFullscreenElement) {
            (document.exitFullscreen || document.webkitExitFullscreen).call(document);
        } else {
            const el = document.documentElement;
            (el.requestFullscreen || el.webkitRequestFullscreen).call(el);
        }
    };

    return (
        <button className="fullscreen-btn" onClick={toggle}
            aria-label={isFS ? 'Exit fullscreen' : 'Enter fullscreen'}
            title={isFS ? 'Exit fullscreen' : 'Fullscreen'}>
            {isFS ? 'â¤¡' : 'â›¶'}
        </button>
    );
}

ReactDOM.createRoot(document.getElementById("root")).render(
    <>
        <FullscreenButton />
        <App />
    </>
);
    </script>
</body>
</html>
